"use strict";function formatDate(a){return null==a?a:new Date(a)}function formatParameter(a){a.updated=formatDate(a.updated)}function formatCompileSubReport(a){a.completed=formatDate(a.completed),a.started=formatDate(a.started)}function formatCompileReport(a){a.completed=formatDate(a.completed),a.started=formatDate(a.started),a.reports.forEach(formatCompileSubReport)}function formatCompileReports(a){a.reports.forEach(formatCompileReport)}function formateVersion(a){a.date=formatDate(a.date)}var app=angular.module("ImperaApp",["ui.router","ui.bootstrap","ngTable","hljs","dialogs.main","angularSpinner","angularAwesomeSlider","ch.filters","ImperaApp.directives","ImperaApp.portalView","ImperaApp.projectsView","ImperaApp.projectView","ImperaApp.resourceView","ImperaApp.resourceCentricView","ImperaApp.envView","ImperaApp.addEnv","ImperaApp.editEnv","ImperaApp.addProject","ImperaApp.graphView","imperaApi.config","ImperaApp.agentsView","ImperaApp.parametersView","ImperaApp.logsView","ImperaApp.reportView","ImperaApp.deployReportView","ImperaApp.controllers.refresh","ImperaApp.controllers.projects","ImperaApp.controllers.side","ImperaApp.feedback","ImperaApp.compileReport","ImperaApp.formsView","ImperaApp.snapshotView","ImperaApp.snapshotDetailView","ImperaApp.restoreView","inmanta.services.userservice"]);app.config(["$urlRouterProvider",function(a){a.otherwise("/projects")}]),app.controller("configCtrl",["$scope","imperaConfig","dialogs",function(a,b,c){a.config=b,a.openFeedback=function(a){c.create("views/feedback/feedback.html","feedbackCtrl",{user:a},{})}}]),app.service("alertService",["$rootScope",function a(b){var c=[],a={};return a.add=function(a,d){var e=c[c.length-1];e&&e.msg==d?e.times=e.times+1:c.push({type:a,msg:d,times:1}),b.$broadcast("alert-update",c)},a}]),app.config(["$httpProvider",function(a){a.interceptors.push(["$q","alertService","userService",function(a,b,c){return{responseError:function(d){if(403==d.status)return c.got_403(d),a.reject(d);var e=d.data?d.data.message:d.statusText;return e||(e="Could not connect to server"),b.add("danger",e),a.reject(d)}}}])}]),app.controller("alertCtrl",["$scope","imperaService",function(a,b){a.alerts=[],a.env=null,a.$on("$stateChangeStart",function(b,c,d,e,f){a.alerts.length=0,a.env=d.env}),a.$on("alert-update",function(b,c){a.alerts=c}),a.closeAlert=function(b){a.alerts.splice(b,1)}}]);var services=angular.module("impera.services.backhaul",["ngTable"]);services.service("Backhaul",["$q",function(a){var b=function(b){var c,d,e,f,g=!0,h=function(){return d.apply(null,e)},i=function(){d&&h().then(function(a){angular.equals(c,a)||(c=a,f())})};this.get=function(j,k){g&&(b.$on("refresh",function(){i()}),g=!1);var l=Array.prototype.slice.call(arguments,2);if(d=k,f=j,c&&angular.equals(e,l)){var m=a.defer();return m.resolve(c),m.promise}return e=l,h().then(function(a){return c=a,a})},this.refresh=i};return b}]),services.service("BackhaulTable",["Backhaul","NgTableParams","$filter",function(a,b,c){return function(d,e,f){var g=new a(d),h=new b(e,{getData:function(a){var b={};return angular.forEach(a.filter(),function(a,c){var d=c.match(/^([a-zA-Z+_]+)\.([a-zA-Z_]+)$/);if(!d)return void(b[c]=a);d=d.splice(1);var e=d[0],f=d[1];b[e]||(b[e]={}),b[e][f]=a}),g.get(function(){a.reload()},f,a).then(function(d){var e=(d.length,a.filter()?c("filter")(d,b):d);return e=a.sorting()?c("orderBy")(e,a.orderBy()):e,a.total(e.length),e.slice((a.page()-1)*a.count(),a.page()*a.count())})}});return h.refresh=g.refresh,h}}]),services.service("BackhaulTablePaged",["Backhaul","NgTableParams","$filter",function(a,b,c){return function(d,e,f,g){var h=new a(d),i=new b(e,{getData:function(a){var b={};return angular.forEach(a.filter(),function(a,c){var d=c.match(/^([a-zA-Z+_]+)\.([a-zA-Z_]+)$/);if(!d)return void(b[c]=a);d=d.splice(1);var e=d[0],f=d[1];b[e]={},b[e][f]=a}),h.get(function(){a.reload()},f,(a.page()-1)*a.count(),a.count()).then(function(d){var e=d[g],f=a.filter()?c("filter")(e,b):e;return f=a.sorting()?c("orderBy")(f,a.orderBy()):f,a.total(d.count),f})}});return i}}]);var imperApi=angular.module("imperaApi",["imperaApi.config"]);imperApi.service("imperaService",["$http","imperaConfig","$q","$cacheFactory","$rootScope","alertService",function(a,b,c,d,e,f){function g(a){var b=w.exec(a);return b||f.add("info","Report to dev: Bad ID received: "+a),{agent_name:b[2],version:b[5],entity_type:b[1],attribute:b[3],attribute_value:b[4]}}function h(a){return{id:a.form_id,type:a.form_type}}function i(a){return{changed:formatDate(a.changed),id:a.record_id}}function j(a){a.started=formatDate(a.started),a.finished=formatDate(a.finished)}function k(a){a.started=formatDate(a.started),a.finished=formatDate(a.finished)}function l(a){var b=[];return a.actions.forEach(function(c){c.data&&Object.keys(c.data).length>0?b.push({id:a.id,type:a.id_fields.entity_type,attr:a.id_fields.attribute,attr_value:a.id_fields.attribute_value,id_fields:a.id_fields,action:c,status:a.status,message:c.message.trim()}):"INFO"!=c.level&&b.push({id:a.id,type:a.id_fields.entity_type,attr:a.id_fields.attribute,attr_value:a.id_fields.attribute_value,id_fields:a.id_fields,action:c,status:a.status,message:c.message.trim()})}),b}function m(a){a.date=formatDate(a.date)}function n(a){a.forEach(m)}function o(a){a.date=formatDate(a.date);for(var b in a.resources)a.resources[b].id_fields=g(b)}var p={},q=b.backend,r={},s={},t="",u=function(a){a!=t&&(v.removeAll(),t=a)},v=d("http-service-cache");a.defaults.cache=v,e.$on("refresh",function(){v.removeAll()});var w=/([a-zA-Z0-9:_-]+)\[([^,]+),([^=]+)=([^\]]+)\],v=(\d+)/;return p.getProjects=function(){return a.get(q+"project").then(function(a){return a.data.projects.forEach(function(a){s[a.id]=a}),a.data.projects})},p.getProjectsAndEnvironments=function(){return c.all({projects:p.getProjects(),envs:p.getEnvironments()}).then(function(a){var b=angular.copy(a.projects),c={};return b.forEach(function(a){c[a.id]=a,a.envs=[]}),angular.copy(a.envs).forEach(function(a){c[a.project].envs.push(a)}),b})},p.getProject=function(b){if(s[b]){var d=c.defer();return d.resolve(s[b]),d.promise}return a.get(q+"project/"+b).then(function(a){return s[a.data.project.id]=a.data.project,a.data.project})},p.addProject=function(b){return a.put(q+"project",{name:b}).then(function(a){return v.removeAll(),a.data.project})},p.removeProject=function(b){return a["delete"](q+"project/"+b)},p.decommission=function(b){return a.post(q+"decommission/"+b)},p.addEnvironment=function(b,c,d,e){return a.put(q+"environment",{project_id:b,name:c,repository:d,branch:e}).then(function(a){return a.data.environment})},p.clone=function(a,b){return p.getEnvironment(a).then(function(a){return p.addEnvironment(a.project,b,a.repo_url,a.repo_branch)})},p.editEnvironment=function(b){return a.post(q+"environment/"+b.id,{id:b.id,name:b.name,repository:b.repo_url,branch:b.repo_branch}).then(function(a){return r[b.id]=a.data.environment,a.data.environment})},p.removeEnvironment=function(b){return a["delete"](q+"environment/"+b)},p.getEnvironments=function(){return a.get(q+"environment").then(function(a){return a.data.environments.forEach(function(a){r[a.id]=a}),a.data.environments})},p.getEnvironmentsByProject=function(a){return p.getEnvironments().then(function(b){var c=[];return b.forEach(function(b){b.project==a&&c.push(b)}),c})},p.getEnvironmentsWithProject=function(){return c.all({projects:p.getProjects(),envs:p.getEnvironments()}).then(function(a){var b=a.projects,c={};b.forEach(function(a){c[a.id]=a});var d=angular.copy(a.envs);return d.forEach(function(a){a.project_full=c[a.project]}),d})},p.getEnvironment=function(b){if(r[b]){var d=c.defer();return d.resolve(r[b]),d.promise}return a.get(q+"environment/"+b).then(function(a){return r[a.data.environment.id]=a.data.environment,a.data.environment})},p.getAgents=function(){return a.get(q+"agent").then(function(a){var b=[],c=new Date(a.data.servertime).getTime();return a.data.nodes.forEach(function(a){a.agents.forEach(function(a){var d=formatDate(a.last_seen);b.push({name:a.name,environment:a.environment,last_seen:d,hostname:a.node,interval:a.interval,expired:d.getTime()+1e3*a.interval*2<c})})}),b})},p.getVersions=function(b){return u(b),a.get(q+"cmversion",{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.versions.forEach(formateVersion),a.data})},p.deleteVersion=function(b,c){return a["delete"](q+"cmversion/"+c,{headers:{"X-Inmanta-tid":b}})},p.getVersionsPaged=function(b,c,d){return u(b),a.get(q+"cmversion?start="+c+"&limit="+d,{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.versions.forEach(formateVersion),a.data})},p.getResources=function(b,c){return u(b),a.get(q+"cmversion/"+c,{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data})},p.getResourcesState=function(b){return u(b),a.get(q+"environment/"+b+"?resources=1&versions=5").then(function(a){return a.data.environment})},p.getResource=function(b,c){return u(b),a.get(q+"resource/"+window.encodeURIComponent(c)+"?logs=",{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.resource})},p.getUnkownsForEnv=function(a){return p.getVersions(a).then(function(b){return b.versions&&0!=b.versions.length?p.getResources(a,b.versions[0].version).then(function(a){return a.unknowns}):[]})},p.getParameters=function(b){return u(b),a.post(q+"parameter",{},{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.parameters.forEach(formatParameter),a.data.now=formatDate(a.data.now),a.data})},p.getReportParameters=function(a){return u(a),p.getParameters(a).then(function(a){return a.parameters.filter(function(a){return"report"==a.metadata.type})})},p.getParameter=function(b,c,d){return u(b),a.get(q+"parameter/"+window.encodeURIComponent(c)+"?resource_id="+window.encodeURIComponent(d),{headers:{"X-Inmanta-tid":b}}).then(function(a){return formatParameter(a.data.parameter),a.data.parameter})},p.getForms=function(b){return u(b),a.get(q+"form",{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.forms.map(h)})},p.getForm=function(b,c){return u(b),a.get(q+"form/"+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.form})},p.getRecords=function(b,c){return u(b),a.get(q+"records?form_type="+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.records.map(i)})},p.getFullRecords=function(a,b){u(a);var d=c.defer();return p.getRecords(a,b).then(function(b){c.all(b.map(function(b){return p.getRecord(a,b.id)})).then(d.resolve)}),d.promise},p.getRecord=function(b,c){return u(b),a.get(q+"records/"+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.record})},p.deleteRecord=function(b,c){return a["delete"](q+"records/"+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}}).then(function(a){return v.removeAll(),a})},p.createRecord=function(b,c,d){var e={};return angular.forEach(d,function(a,b){e[b]=String(a)}),a.post(q+"records",{form_type:c,form:e},{headers:{"X-Inmanta-tid":b}}).then(function(a){return v.removeAll(),a})},p.updateRecord=function(b,c,d){var e={};return angular.forEach(d,function(a,b){e[b]=String(a)}),a.put(q+"records/"+window.encodeURIComponent(c),{form:e},{headers:{"X-Inmanta-tid":b}}).then(function(a){return v.removeAll(),a})},p.getSnapshots=function(b){return u(b),a.get(q+"snapshot",{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.snapshots.forEach(j),a.data.snapshots})},p.getSnapshot=function(b,c){return u(b),a.get(q+"snapshot/"+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}}).then(function(a){return j(a.data.snapshot),a.data.snapshot})},p.deleteSnapshot=function(b,c){return u(b),a["delete"](q+"snapshot/"+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}})},p.createSnapshot=function(b,c){return u(b),a.post(q+"snapshot",{name:c},{headers:{"X-Inmanta-tid":b}})},p.restoreSnapshot=function(b,c){return a.post(q+"restore",{snapshot:c},{headers:{"X-Inmanta-tid":b}})},p.getAllSnapshots=function(a){var b=c.defer();return p.getSnapshots(a).then(function(d){c.all(d.map(function(b){return p.getSnapshot(a,b.id)})).then(b.resolve)}),b.promise},p.getRestores=function(b){return a.get(q+"restore",{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data.restores.forEach(k),a.data.restores})},p.getEnrichedRestores=function(a){var b=c.defer();return p.getRestores(a).then(function(d){c.all(d.map(function(b){return p.getSnapshot(a,b.snapshot).then(function(a){return b.snapshot_full=a,b.snapshot_id=a.name,b},function(){return b.snapshot_id=b.id,b})})).then(b.resolve)}),b.promise},p.deleteRestore=function(b,c){return a["delete"](q+"restore/"+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}})},p.deploy=function(b,c,d){return a.post(q+"cmversion/"+c,{push:d},{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data})},p.getDeployReport=function(b,c){return u(b),a.get(q+"cmversion/"+window.encodeURIComponent(c)+"?include_logs=true&log_filter=deploy",{headers:{"X-Inmanta-tid":b}}).then(function(a){var b=[];return a.data.resources.forEach(function(a){a.actions&&a.actions.length>0&&(b=b.concat(l(a)))}),{resources:b,unknowns:a.data.unknowns}})},p.dryrun=function(b,c){return u(b),a.post(q+"dryrun/"+c,{},{headers:{"X-Inmanta-tid":b}}).then(function(a){return o(a.data.dryrun),a.data.dryrun})},p.getDryruns=function(b,c){return u(b),c?a.get(q+"dryrun?version="+c,{headers:{"X-Inmanta-tid":b}}).then(function(a){return n(a.data.dryruns),a.data.dryruns}):a.get(q+"dryrun",{headers:{"X-Inmanta-tid":b}}).then(function(a){return n(a.data.dryruns),a.data.dryruns})},p.getDryrun=function(b,c){return u(b),a.get(q+"dryrun/"+window.encodeURIComponent(c),{headers:{"X-Inmanta-tid":b}}).then(function(a){return o(a.data.dryrun),a.data.dryrun})},p.getFile=function(b){return a.get(q+"file/"+window.encodeURIComponent(b)).then(function(a){return a.data.content=window.atob(a.data.content),a.data})},p.downloadFile=function(a){window.open(q+"file/"+window.encodeURIComponent(a))},p.getDiff=function(b,c){return a.post(q+"filediff",{a:b,b:c}).then(function(a){return a.data})},p.getLogForResource=function(b,c){return u(b),a.get(q+"resource/"+window.encodeURIComponent(c)+"?logs=true",{headers:{"X-Inmanta-tid":b}}).then(function(a){return a.data})},p.sendFeedback=function(a){var b=c.defer();return b.resolve(null),b.promise},p.compile=function(b){return a.get(q+"notify/"+b+"?update=0")},p.updateCompile=function(b){return a.get(q+"notify/"+b)},p.isCompiling=function(b){return a.head(q+"notify/"+b).then(function(a){return 200==a.status})},p.getCompileReports=function(b){return a.get(q+"compilereport?environment="+b).then(function(a){return formatCompileReports(a.data),a.data.reports})},p}]);var services=angular.module("impera.services.time",[]);services.service("timeSrv",["$rootScope","$timeout",function(a,b){var c,d,e,f={};f.getRefresh=function(){return c},f.getInterval=function(){return e},f.setInterval=function(a){e=a,a=f.interval_to_ms(a),a?(c=a,f.start_refresh(a)):(e="Off",f.cancel_refresh())},f.refresh=function(){a.$broadcast("refresh")},f.start_refresh=function(a){f.refresh(),f.cancel_refresh(),d=b(function(){f.start_refresh(a)},a)},f.cancel_refresh=function(){b.cancel(d)};var g=/(\d+(?:\.\d+)?)([Mwdhmsy])/,h={y:31536e3,M:2592e3,w:604800,d:86400,h:3600,m:60,s:1};return f.describe_interval=function(a){var b=a.match(g);if(b&&h[b[2]])return{sec:h[b[2]],type:b[2],count:parseInt(b[1],10)};throw new Error('Invalid interval string, expexcting a number followed by one of "Mwdhmsy"')},f.interval_to_ms=function(a){var b=f.describe_interval(a);return 1e3*b.sec*b.count},f.setInterval("5s"),f}]);var imperApi=angular.module("inmanta.services.userservice",["imperaApi.config","dialogs.main","ImperaApp.login"]);imperApi.service("userService",["imperaConfig","$q","$rootScope","$injector",function(a,b,c,d){function e(a){h=a;var b=d.get("$http");b.defaults.headers.common["X-inmanta-user"]=a}var f={},g=a.backend,h="";return f.got_403=function(a){var b=d.get("dialogs");b.create("views/login/login.html","loginCtrl",{},{})},f.login=function(a,b){var c=d.get("$http");return c.post(g+"login",{user:a,password:b}).then(function(a){e(a.data.token)})},f}]);var imperApi=angular.module("ImperaApp.directives",[]);imperApi.filter("nozero",function(){return function(a){return 0==a?"":a}}),imperApi.directive("deployProgress",function(){var a=["failed","skipped","deployed"],b={deployed:"success",skipped:"info",failed:"danger"},c=function(c){var d={},e=[],f=c.status,g=c.total;for(var h in f){var i=f[h];i in d?d[i]++:d[i]=1}a.forEach(function(a){var c=d[a];c&&e.push({name:a,value:100*c/g,label:c,type:b[a]})});var j={total:c.total,bars:e,done:c.done};return j};return{restrict:"E",templateUrl:"partials/directives/deployProgress.html",transclude:!0,scope:{datain:"=data",name:"=name",action:"=",emptyaction:"=?emptyaction",emptyname:"=?emptyname"},link:function(a,b,d){a.width=10,d.width&&(a.width=d.width),a.remainder=10-a.width,a.data=null,a.$watch("datain",function(b,d){b&&(a.data=c(b))},!0)}}}),imperApi.directive("imBreadcrumb",["$stateParams","imperaService",function(a,b){return{restrict:"E",templateUrl:"partials/directives/breadcrumb.html",scope:{name:"=?name",id:"=?id"},link:function(c,d,e){function f(a,b,d){var e={name:a,id:b,sref:d,last:!1};return c.breadcrumb.push(e),e}if(c.breadcrumb=[],f("Home",null,"projects"),a.env){var g=f("Environment","","envs({env:'"+a.env+"'})");b.getEnvironment(a.env).then(function(a){g.id=a.name})}a.version&&f("Version",a.version,"resources({env:'"+a.env+"',version:'"+a.version+"'})"),e.name&&f(c.name,c.id,null),c.breadcrumb[c.breadcrumb.length-1].last=!0}}}]);var rscdet=angular.module("ImperaApp.inputDialog",["imperaApi","dialogs.main"]);rscdet.controller("inputDialogCtrl",["$scope","$modalInstance","data","imperaService",function(a,b,c,d){a.header=c.header,a.icon="glyphicon glyphicon-info-sign",a.content=c.content,a.close=function(){b.close(a.result),a.$destroy()}}]);var resv=angular.module("ImperaApp.controllers.projects",["imperaApi"]);resv.controller("projectsController",["$scope","imperaService",function(a,b){function c(){b.getProjectsAndEnvironments().then(function(b){a.projects=b})}function d(c){b.getEnvironment(c).then(function(b){a.currentEnv=b,e(b.project)})}function e(c){b.getProject(c).then(function(b){a.currentProject=b})}c(),a.$on("refresh",c),a.$on("$stateChangeStart",function(b,c,f,g,h){f.env?d(f.env):(a.currentEnv=null,f.project?e(f.project):a.currentProject=null)})}]);var resv=angular.module("ImperaApp.controllers.refresh",["impera.services.time"]);resv.controller("refreshController",["$scope","timeSrv",function(a,b){a.timeSrv=b,a.refresh_intervals=["off","1s","5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],a.refresh=b.getInterval(),a.$on("refresh",function(){a.lastTime=Date.now()}),a.setRefresh=function(c){"off"==c?(c="0s",a.refresh=0):a.refresh=c,b.setInterval(c)}}]);var resv=angular.module("ImperaApp.controllers.side",["ui.router"]);resv.controller("sideController",["$scope","$rootScope","imperaService","$stateParams",function(a,b,c,d){a.state=d}]);var resv=angular.module("ImperaApp.addEnv",["ui.router","imperaApi","ngTable"]);resv.config(["$stateProvider",function(a){a.state("addEnv",{url:"/addEnvironment?project",views:{body:{templateUrl:"views/addEnv/addEnv.html",controller:"addEnvController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("addEnvController",["$scope","imperaService","$state","$stateParams","$rootScope",function(a,b,c,d,e){a.name=null,a.selectedTag=null,a.ready=function(){return a.selectedProject},b.getProjects().then(function(b){a.projects=b,d.project&&(a.selectedProject=b.filter(function(a){return a.id==d.project})[0])}),a.addEnv=function(a,d,f,g){b.addEnvironment(a,d,f,g).then(function(a){e.$broadcast("refresh"),c.go("envs",{env:a.id})})},a.projects=null}]);var resv=angular.module("ImperaApp.addProject",["ui.router","imperaApi","ngTable"]);resv.config(["$stateProvider",function(a){a.state("addProject",{url:"/addProject",views:{body:{templateUrl:"views/addProject/addProject.html",controller:"addProjectController"},side:{templateUrl:"partials/emptysidebar.html"}}})}]),resv.controller("addProjectController",["$scope","imperaService","$state",function(a,b,c){a.name=null,a.ready=function(){return a.selectedProject},b.getProjects().then(function(b){a.projects=b}),a.addProject=function(a){b.addProject(a).then(function(a){c.go("addEnv",{project:a.id})})},a.projects=null}]);var resv=angular.module("ImperaApp.agentsView",["ui.router","imperaApi","ngTable","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("agents",{url:"/agents?env",views:{body:{templateUrl:"views/agents/agentBody.html",controller:"agentController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("agentController",["$scope","imperaService","$stateParams","$q","BackhaulTable",function(a,b,c,d,e){a.state=c,a.getEnv=function(a){var c=[];return b.getEnvironment(a).then(function(a){c[0]=a}),c},a.envs=d.defer(),a.tableParams=new e(a,{page:1,count:1e3},function(c){return b.getAgents().then(function(b){a.alldata={};var c=[];return new Set(b.map(function(a){return a.environment})).forEach(function(a){c.push(a)}),a.envs.resolve(c),b})}),c.env&&(a.tableParams.filter().environment=c.env),a.resources=null,a.names=function(){var c=d.defer(),e=[],f=0;return a.envs.promise.then(function(a){angular.forEach(a,function(a){f+=1,b.getEnvironment(a).then(function(b){e.push({id:a,title:b.name}),f-=1,0==f&&c.resolve(e)})})}),c}}]);var resv=angular.module("ImperaApp.compileReport",["ui.router","imperaApi"]);resv.config(["$stateProvider",function(a){a.state("compileReport",{url:"/environment/:env/compilereport",views:{body:{templateUrl:"views/compileReport/compileBody.html",controller:"compileReportController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("compileReportController",["$scope","imperaService","$stateParams",function(a,b,c){function d(){b.getCompileReports(c.env).then(function(b){a.compiles=b,b.forEach(function(a){a.reports.forEach(function(a){"open"in a||(a.open=0!=a.returncode)})}),a.compile||(a.compile=b[0])})}a.state=c,b.getEnvironment(c.env).then(function(b){a.env=b}),d(),a.$on("refresh",d)}]);var resv=angular.module("ImperaApp.deployReportView",["ui.router","imperaApi","ngTable","dialogs.main","ImperaApp.diffDetail"]);resv.config(["$stateProvider",function(a){a.state("deployReport",{url:"/environment/:env/version/:version/deploy",views:{body:{templateUrl:"views/deployReport/reportBody.html",controller:"deployReportController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("deployReportController",["$scope","imperaService","$stateParams","dialogs","BackhaulTable","$q","$rootScope",function(a,b,c,d,e,f,g){a.state=c,a.tableParams=new e(a,{page:1,count:50},function(d){return b.getDeployReport(c.env,c.version).then(function(b){return a.data=b,b.resources})}),b.getEnvironment(c.env).then(function(b){a.env=b}),a.open=function(a,b){d.create("views/diffDetail/diffDetail.html","diffDetailCtrl",{diff:a,id:b},{})}}]);var rscdet=angular.module("ImperaApp.diffDetail",["imperaApi","dialogs.main"]);rscdet.controller("diffDetailCtrl",["$scope","$modalInstance","data","imperaService",function(a,b,c,d){a.content="",a.header=c.id,d.getDiff(c.diff[0],c.diff[1]).then(function(b){a.content=b.diff}),a.icon="glyphicon glyphicon-info-sign",a.close=function(){b.close(),a.$destroy()}}]);var resv=angular.module("ImperaApp.editEnv",["ui.router","imperaApi","ngTable"]);resv.config(["$stateProvider",function(a){a.state("editEnv",{url:"/editEnvironment/:env",views:{body:{templateUrl:"views/editEnv/editEnv.html",controller:"editEnvController"},side:{templateUrl:"views/env/envSide.html",controller:"envController"}}})}]),resv.controller("editEnvController",["$scope","imperaService","$stateParams","$state",function(a,b,c,d){a.state=c,b.getEnvironment(c.env).then(function(c){a.env=c,b.getProject(c.project).then(function(b){a.selectedProject=b}),a.name=c.name,a.selectedTag=c.repo_branch,a.repo=c.repo_url}),a.editEnv=function(c,e,f,g){a.env.name=e,a.env.repo_branch=g,a.env.repo_url=f,b.editEnvironment(a.env).then(function(a){d.go("envs",{env:a.id})})}}]);var resv=angular.module("ImperaApp.envView",["ui.router","imperaApi","ngTable","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("envs",{url:"/environment/:env",views:{body:{templateUrl:"views/env/envBody.html",controller:"envController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("envFunctionController",["$scope","$rootScope","imperaService","$stateParams","$state","dialogs",function(a,b,c,d,e,f){a.state=d,a.compile=function(d){c.compile(d).then(function(){a.cstate=!0,b.$broadcast("refresh")})},a.decommission=function(a){var d=f.confirm("Confirm delete","Do you really want to decomission the environment "+a.name+" this can NOT BE UNDONE! ");d.result.then(function(d){c.decommission(a).then(function(a){b.$broadcast("refresh")})})},a.clone=function(a){f.create("partials/input/inputDialog.html","inputDialogCtrl",{header:"Clone name",content:"Name for the clone"},{}).result.then(function(d){c.clone(a,d).then(function(a){b.$broadcast("refresh"),e.go("envs",{env:a.id})})})},a.updateCompile=function(d){c.updateCompile(d).then(function(){a.cstate=!0,b.$broadcast("refresh")})};var g=function(){a.state.env&&c.isCompiling(a.state.env).then(function(b){a.cstate=b})};g(),a.$on("refresh",g)}]),resv.controller("envController",["$scope","$rootScope","imperaService","$stateParams","BackhaulTablePaged","dialogs",function(a,b,c,d,e,f){a.state=d,a.tableParams=e(a,{page:1,count:10,sorting:{"id_fields.entity_type":"asc"}},function(a,b){return c.getVersionsPaged(d.env,a,b).then(function(a){return a.versions.forEach(function(a){a.state=g(a)}),a})},"versions"),a.resources=null,c.getEnvironment(d.env).then(function(b){a.env=b}),a.startDryRun=function(a){var e=a.version;c.dryrun(d.env,e).then(function(a){b.$broadcast("refresh")})},a.deploy=function(a){var e=a.version;c.deploy(d.env,e,!0).then(function(a){b.$broadcast("refresh")})},a.deleteVersion=function(a){var e=a.version,g=f.confirm("Confirm delete","Do you really want to delete the version "+e);g.result.then(function(a){c.deleteVersion(d.env,e).then(function(a){b.$broadcast("refresh")})})};var g=function(a){return a.released?a.deployed?"deployed":a.result:"new"}}]);var rscdet=angular.module("ImperaApp.feedback",["imperaApi","dialogs.main"]);rscdet.controller("feedbackCtrl",["$scope","$modalInstance","data","imperaService",function(a,b,c,d){a.submitFeedback=function(a){d.sendFeedback(a).then(function(a){b.close("closed")})},a.cancel=function(){b.dismiss("cancel")}}]);var rscdet=angular.module("ImperaApp.fileDetail",["imperaApi","dialogs.main"]);rscdet.controller("fileDetailCtrl",["$scope","$modalInstance","data","imperaService",function(a,b,c,d){a.header="Details for "+c.resource.id,a.id=c.resource.fields.hash,a.icon="glyphicon glyphicon-info-sign",a.content="",d.getFile(a.id).then(function(b){a.content=b.content}),a.close=function(){b.close(),a.$destroy()}}]);var resv=angular.module("ImperaApp.formsView",["ui.router","imperaApi","ngTable","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("forms",{url:"/environment/:env/forms?form",views:{body:{templateUrl:"views/formsView/formsViewBody.html",controller:"formsController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.directive("recordEditor",["imperaService","dialogs","BackhaulTable","$rootScope",function(a,b,c,d){return{restrict:"E",scope:{env:"=",type:"=",highlight:"=?"},templateUrl:"views/formsView/recordEditor.html",link:function(e,f){function g(){null!=e.type&&(e.tableParams=new c(e,{page:1,count:50},function(b){return a.getFullRecords(e.env,e.type).then(function(a){return e.allRecords=a,a})}),a.getForm(e.env,e.type).then(function(a){e.selectedForm=a,e.cols.length=0,angular.forEach(a.fields,function(a,b){var c="fields."+b,d={};d[c]="text",e.cols.push({title:b.replace("_"," "),sortable:c,filter:d,show:!0,field:b})}),e.cols.sort(function(a,b){return a.field>b.field}),e.cols.push({title:"",show:!0})}))}e.cols=[],g(),e.$watch("type",g),e.getOptionsFor=function(a){return a.split(",")};var h={string:"text",number:"text",bool:"checkbox"},i={string:"",number:0,slider:0,bool:!1};e.getFormType=function(a){return a in h?h[a]:"text"};var j=function(a,b,c){if("number"==a&&b.field_options[c]&&b.field_options[c].min){var d=b.field_options[c].min;return d>0?d:0}return a in i?i[a]:""};e["delete"]=function(c){var f=b.confirm("Confirm delete","Do you really want to delete the record "+c);f.result.then(function(b){a.deleteRecord(e.env,c.record_id).then(function(){d.$broadcast("refresh")})})},e.addNew=function(a){var b={};angular.forEach(a.fields,function(c,d){b[d]=j(c,a,d)});var c={fields:b,form_type:a.form_type,edit:!0};e.edit(a,c)},e.edit=function(a,c){b.create("views/formsView/formDialog.html","formDialogController",{type:a,record:c},{}).result.then(function(){d.$broadcast("refresh")})}}}}]),resv.controller("formsController",["$scope","imperaService","$stateParams",function(a,b,c){function d(){b.getForms(c.env).then(function(b){a.forms=b}),b.getUnkownsForEnv(c.env).then(function(b){a.unknowns=b.filter(function(a){return"form"==a.source}).map(function(a){return a.metadata.form})})}a.state=c,d(),a.$on("refresh",d),a.selectForm=function(b){a.sfi=b.type}}]),resv.controller("formDialogController",["$scope","imperaService","$stateParams","$modalInstance","data",function(a,b,c,d,e){a.state=c,a.record=e.record,a.form=e.type;var f={string:"text",number:"text",bool:"checkbox"},g=function(a,b,c){var d={widget:i(b,c)};return c&&(c.help&&(d.help=c.help),"options"==d.widget&&(d.options=c.options.split(",")),"slider"==d.widget&&(d.options=h(c))),d},h=function(a){if(!a)return{};var b=parseInt(a.min);b||(b=0);var c=parseInt(a.max);return c||(c=100),{from:b,to:c,step:1}},i=function(a,b){return b&&b.widget?b.widget:a in f?f[a]:"text"};a.fieldList=[],angular.forEach(e.type.fields,function(b,c){a.fieldList.push({key:c,value:b,options:g(c,b,e.type.field_options[c])})}),a.fieldList.sort(function(a,b){return a.key>b.key});var j=function(a){return a.record_id?b.updateRecord(c.env,a.record_id,a.fields):b.createRecord(c.env,a.form_type,a.fields)};a.submit=function(){j(a.record).then(function(b){d.close(b),a.$destroy()})},a.close=function(){d.close(),a.$destroy()}}]);var resv=angular.module("ImperaApp.graphView",["ui.router","imperaApi","dialogs.main","ImperaApp.resourceDetail"]);resv.config(["$stateProvider",function(a){a.state("graph",{url:"/environment/:env/version/:version/graph",views:{body:{templateUrl:"views/graph/graph.html",controller:"graphController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("graphController",["$scope","imperaService","$stateParams","dialogs",function(a,b,c,d){function e(a){var b=m[a];return b?b:"?"}function f(a){var b=n[a];return b?b:"#337ab7"}function g(){z.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function h(a,b){l(a,b),q.px||(q.px=q.x=s/2,q.py=q.y=j(q)+2),y.nodes(a).links(b).start(),p=z.selectAll("line.link").data(b.filter(function(a){return!a.toHost||a.target.depth<3}),function(a){return a.id}),p.enter().append("path").attr("class","link").attr("d",r),p.exit().remove(),o=z.selectAll("g.node").data(a,function(a){return a.id});var c=o.enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.y+","+a.x+")"});c.on("click",k).call(y.drag),c.on("mousedown",function(a){d3.event.stopPropagation()}),c.append("text").attr("dx",function(a){return a.children?-8:8}).attr("dy",3).style("text-anchor",function(a){return a.children?"end":"start"}).text(function(a){return a.sname}),c.append("text").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-family","Glyphicons Halflings").attr("font-size",function(a){
return"1em"}).attr("fill",function(a){return a.color}).text(function(a){return a.icon}),o.transition().attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),o.exit().remove()}function i(a){var b=(a.alpha,Math.max((a.alpha-x)*u,0));y.nodes().forEach(function(a){if(!a.fixed){var c=j(a)+4;if(a.children){var d=a.depth*v+c,e=d-a.x;Math.abs(e)>b&&(a.x=d)}}}),p.attr("d",r),o.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}function j(a){return a.children?4.5:Math.sqrt(a.size)/10}function k(a){d3.event.defaultPrevented||d.create("views/resourceDetail/resourceDetail.html","resourceDetailCtrl",{resource:a.source,env:c.env},{})}function l(a,b){function c(a){if(a.depth)return a.depth;var b=Math.max.apply(null,a.parents.map(c));return b=Math.max(b,0)+1,a.depth=b,b}function d(a){if(a.weight)return a.weight;var b=a.children.map(d).reduce(function(a,b){return a+b},0)+1;return a.weight=b,b}function e(a,b){return f=Math.max(f,b),a.children&&(a.children.sort(function(a,b){return b.weight-a.weight}),g=Math.max(g,a.depth+1),a.size=a.children.reduce(function(a,c,d){return a+e(c,b+a)},1)),a.x||(a.x=a.depth,a.y=b+a.size/2),a.size}var f=0,g=1;a.forEach(c),a.forEach(d),q={name:"root",parents:[],children:[],depth:0,parent:null},q.fixed=!0,q.px=q.py=0,a.forEach(function(a){1==a.depth&&(q.children.push(a),a.parents.push(q))}),q.size=e(q,0);var h,i=(t-20)/f,j=(s-20)/g;for(h=a.length;--h>=0;){var k=a[h];k.px||(k.y*=i,k.y+=10+i/2,k.x*=j,k.x+=10+j/2)}return a}a.dryrun=function(){b.dryrun(c.env,c.version).then(function(a){$rootScope.$broadcast("refresh")})};var m={"std::File":"","std::Package":"","std::Directory":"","std::Service":"","exec::Run":"","vm::Host":""},n={deployed:"#5cb85c",ERROR:"#d9534f",WAITING:"#5bc0de"};a.resources=null,b.getEnvironment(c.env).then(function(b){a.env=b}),a.state=c;var o,p,q,r=d3.svg.diagonal(),s=2e3,t=2e3,u=400,v=300,w=280,x=.08,y=d3.layout.force().on("tick",i).charge(function(a){return-600}).linkDistance(function(a){var b=Math.abs(w*(a.target.depth-a.source.depth));return b}).size([s,t]),g=d3.behavior.zoom().size([s,t]).on("zoom",g),z=d3.select("#chart").append("svg").attr("width","100%").attr("height","2000px").append("g");g(d3.select("#chart")),g.translate([0,.5*-(t-window.innerHeight)]),g.event(d3.select("#chart")),b.getResources(c.env,c.version).then(function(a){var b=0,c={},d={},g=[],i=[];a.resources.forEach(function(a){var h={name:a.id,req:a.fields.requires,parents:[],children:[],id:b++,sname:a.id_fields.attribute_value.substring(0,25),icon:e(a.id_fields.entity_type),agent:a.id_fields.agent_name,source:a,color:f(a.status)};g.push(h),c[a.id]=h,"vm::Host"==a.id_fields.entity_type&&(d[a.id_fields.attribute_value]=h)}),g.forEach(function(a){a.req.forEach(function(d){a.parents.push(c[d]),c[d].children.push(a),i.push({target:a,source:c[d],id:b++})});var e=d[a.agent];e&&(a.parents.push(e),e.children.push(a),i.push({target:a,source:e,id:b++,toHost:!0}))}),h(g,i)})}]);var resv=angular.module("ImperaApp.logsView",["ui.router","imperaApi","ngTable","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("logs",{url:"/environment/:env/resource/:id?version",views:{body:{templateUrl:"views/log/logBody.html",controller:"logController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("logController",["$scope","imperaService","$stateParams","BackhaulTable","$q",function(a,b,c,d,e){c.id=window.decodeURIComponent(c.id),a.state=c,a.cmversion=c.id.substring(c.id.lastIndexOf("=")+1),c.version=a.cmversion,a.tableParams=new d(a,{page:1,count:10,sorting:{timestamp:"desc"}},function(d){return b.getLogForResource(c.env,c.id).then(function(b){var c=b.logs;return a.resource=b.resource,c})}),b.getEnvironment(c.env).then(function(b){a.env=b}),a.names=function(){var a=e.defer(),b=[{id:"fact",title:"fact"},{id:"user",title:"user"},{id:"plugin",title:"plugin"}];return a.resolve(b),a},a.tf=function(){var a=e.defer(),b=[{id:"true",title:"expired"},{id:"false",title:"not expired"}];return a.resolve(b),a}}]);var rscdet=angular.module("ImperaApp.login",["inmanta.services.userservice","dialogs.main"]);rscdet.controller("loginCtrl",["$scope","$modalInstance","userService",function(a,b,c){a.login=function(a,d){c.login(a,d).then(function(a){b.close("closed")})},a.cancel=function(){b.dismiss("cancel")}}]);var resv=angular.module("ImperaApp.parametersView",["ui.router","imperaApi","ngTable"]);resv.config(["$stateProvider",function(a){a.state("params",{url:"/parameters/:env",views:{body:{templateUrl:"views/parameters/parametersBody.html",controller:"paramsController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("paramsController",["$scope","imperaService","$stateParams","BackhaulTable","$q",function(a,b,c,d,e){a.state=c,a.tableParams=new d(a,{page:1,count:10,sorting:{"id_fields.entity_type":"asc"}},function(d){return b.getParameters(c.env).then(function(b){var c=b.parameters;a.expire=b.expire;var d=Date.now();return a.servertime=b.now,a.drift=b.now-d,c.forEach(function(b){b.expired=b.updated.getTime()+1e3*a.expire<a.servertime.getTime()}),c})}),a.resources=null,b.getEnvironment(c.env).then(function(b){a.env=b}),a.getRecord=function(a){return{"in":a,show:!1,value:""}},a.getValue=function(c){b.getParameter(a.state.env,c["in"].name,c["in"].resource_id).then(function(a){c.out=a,c.value=a.value,c.show=!0})},a.names=function(){var a=e.defer(),b=[{id:"fact",title:"fact"},{id:"user",title:"user"},{id:"plugin",title:"plugin"},{id:"report",title:"report"}];return a.resolve(b),a},a.tf=function(){var a=e.defer(),b=[{id:"true",title:"expired"},{id:"false",title:"not expired"}];return a.resolve(b),a}}]);var module=angular.module("ImperaApp.portalView",["ui.router","imperaApi"]);module.config(["$stateProvider",function(a){a.state("portal",{url:"/environment/:env/portal",views:{body:{templateUrl:"views/portal/portalBody.html",controller:"PortalController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),module.controller("PortalController",["$scope","$rootScope","imperaService","$stateParams","$state","dialogs",function(a,b,c,d,e,f){a.state=d,c.getEnvironment(d.env).then(function(b){a.env=b});var g=function(){c.getReportParameters(d.env).then(function(b){a.report=b})};a.$on("refresh",g),g();var h=function(){c.getUnkownsForEnv(d.env).then(function(b){var b=b.filter(function(a){return"form"==a.source}),c={};b.forEach(function(a){c[a.metadata.form]=a}),a.unknowns=Object.keys(c).map(function(a){return c[a]})})};a.$on("refresh",h),h();var i=function(b){c.getVersionsPaged(d.env,0,b).then(function(c){var d,e,f=c.count,g=0;for(var h in c.versions){var j=c.versions[h];if(0==g){if(j.deployed){d=j;break}e=j,g=1}else if(j.deployed){d=j;break}}1==g&&f>b&&i(2*b),a.newVersion=e,a.lastVersion=d})},j=function(){i(10)};a.$on("refresh",j),j(),a.startDryRun=function(a){var e=a.version;c.dryrun(d.env,e).then(function(a){b.$broadcast("refresh")})},a.deploy=function(a){var e=a.version;c.deploy(d.env,e,!0).then(function(a){b.$broadcast("refresh")})}}]);var resv=angular.module("ImperaApp.projectView",["ui.router","imperaApi","ngTable","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("project",{url:"/project/:project",views:{body:{templateUrl:"views/project/projectBody.html",controller:"projectviewController"},side:{templateUrl:"partials/emptysidebar.html"}}})}]),resv.controller("projectviewController",["$scope","imperaService","$stateParams","BackhaulTable","$q","dialogs","$rootScope",function(a,b,c,d,e,f,g){a.state=c,a.tableParams=new d(a,{page:1,count:10,sorting:{name:"asc"}},function(a){return b.getEnvironmentsByProject(c.project)}),a.deleteEnv=function(a){var c=f.confirm("Confirm delete","Do you really want to delete the environment "+a.name);c.result.then(function(c){b.removeEnvironment(a.id).then(function(){g.$broadcast("refresh")})})}}]);var resv=angular.module("ImperaApp.projectsView",["ui.router","imperaApi","ngTable","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("projects",{url:"/projects",views:{body:{templateUrl:"views/projects/projectBody.html",controller:"projectsviewController"},side:{templateUrl:"partials/emptysidebar.html"}}})}]),resv.controller("projectsviewController",["$scope","imperaService","$rootScope","$stateParams","BackhaulTable","$q","dialogs",function(a,b,c,d,e,f,g){a.state=d,a.tableParams=new e(a,{page:1,count:10,sorting:{name:"asc"}},function(a){return b.getProjects()}),a.deleteProject=function(a){var d=g.confirm("Confirm delete","Do you really want to delete the project "+a.name);d.result.then(function(d){b.removeProject(a.id).then(function(){c.$broadcast("refresh")})})}}]);var resv=angular.module("ImperaApp.reportView",["ui.router","imperaApi","ngTable","dialogs.main","ImperaApp.diffDetail"]);resv.config(["$stateProvider",function(a){a.state("report",{url:"/environment/:env/version/:version/report?id",views:{body:{templateUrl:"views/report/reportBody.html",controller:"reportController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("reportController",["$scope","imperaService","$stateParams","dialogs","BackhaulTable","$q","$rootScope",function(a,b,c,d,e,f,g){function h(){b.getDryruns(c.env,c.version).then(function(b){b.reverse(),a.dryruns=b,!a.state.id&&b.length>0&&(a.state.id=b[0].id,a.tableParams.refresh())})}a.state=c,a.tableParams=new e(a,{page:1,count:50},function(d){if(c.id)return b.getDryrun(c.env,a.state.id).then(function(b){a.dryrun=b;var c=[];for(var d in b.resources){var e=angular.copy(b.resources[d]);e.id=d,e.changessize=Object.keys(e.changes).length,c.push(e)}return c});var e=f.defer();return e.resolve([]),e.promise}),a.$watch("dryrun.id",function(){a.dryrun.id&&(a.state.id=a.dryrun.id,a.tableParams.refresh())},!0),h(),a.$on("refresh",h),b.getEnvironment(c.env).then(function(b){a.env=b}),a.open=function(a,b){d.create("views/diffDetail/diffDetail.html","diffDetailCtrl",{diff:a,id:b},{})},a.dryrun=function(){b.dryrun(c.env,c.version).then(function(a){g.$broadcast("refresh")})},a.details=function(a){b.getResource(c.env,a.id).then(function(a){d.create("views/resourceDetail/resourceDetail.html","resourceDetailCtrl",{resource:a,env:c.env},{})})}}]);var resv=angular.module("ImperaApp.resourceView",["ui.router","imperaApi","ngTable","dialogs.main","ImperaApp.resourceDetail","ImperaApp.fileDetail","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("resources",{url:"/environment/:env/version/:version",views:{body:{templateUrl:"views/resource/resourceBody.html",controller:"resourceController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("resourceButtonController",["$scope","$rootScope","imperaService","$stateParams",function(a,b,c,d){a.dryrun=function(){c.dryrun(d.env,d.version).then(function(c){a.dryrunid=c.id,b.$broadcast("refresh")})},a.deploy=function(){c.deploy(d.env,d.version,!0).then(function(a){b.$broadcast("refresh")})}}]),resv.controller("resourceController",["$scope","$rootScope","imperaService","$stateParams","BackhaulTable","dialogs","$q",function(a,b,c,d,e,f,g){a.state=d,a.toHighlight=null,a.highlight=function(b){a.toHighlight==b?a.toHighlight=null:a.toHighlight=b},a.deploy=function(){c.deploy(d.env,d.version,!0).then(function(a){b.$broadcast("refresh")})},a.tableParams=new e(a,{page:1,count:10,sorting:{"id_fields.entity_type":"asc"}},function(b){return c.getResources(d.env,d.version).then(function(b){a.status=b.model;var c=b.resources;return a.alldata={},angular.forEach(c,function(b){a.alldata[b.id]=b}),angular.forEach(c,function(b){a.deporder(b)}),c})}),a.resources=null,a.deporderInt=function(b){if(!a.alldata[b]){var c=Math.max.apply(null,a.alldata[b].fields.requires.map(a.deporderInt));return c=Math.max(c,0)+1,a.alldata[b].deporderv=c,c}return a.alldata[b].deporderv},a.deporder=function(b){var c=a.deporderInt(b.id);return b.deporder=c,c},a.details=function(a){f.create("views/resourceDetail/resourceDetail.html","resourceDetailCtrl",{resource:a,env:d.env},{})},a.open=function(a){f.create("views/fileDetail/fileDetail.html","fileDetailCtrl",{resource:a,env:d.env},{})},a.states=function(){var a=g.defer(),b=[{id:"skipped",title:"skipped"},{id:"deployed",title:"deployed"},{id:"failed",title:"failed"},{id:"!*",title:"empty"}];return a.resolve(b),a},a.setsort=function(b){a.tableParams.filter().status=b},a.resources=null,c.getEnvironment(d.env).then(function(b){a.env=b})}]);var rscdet=angular.module("ImperaApp.resourceDetail",["imperaApi","dialogs.main"]);rscdet.controller("resourceDetailCtrl",["$scope","$modalInstance","data","dialogs",function(a,b,c,d){a.header="Details for "+c.resource.id,a.env=c.env,a.keys=Object.keys(c.resource.fields),a.data=c.resource,a.icon="glyphicon glyphicon-info-sign",a.close=function(){b.close(),a.$destroy()},a.open=function(){b.close(),d.create("views/fileDetail/fileDetail.html","fileDetailCtrl",{resource:a.data},{}),a.$destroy()}}]);var resv=angular.module("ImperaApp.resourceCentricView",["ui.router","imperaApi","ngTable","dialogs.main","ImperaApp.resourceDetail","ImperaApp.fileDetail","impera.services.backhaul"]);resv.config(["$stateProvider",function(a){a.state("resourceCentric",{url:"/environment/:env/resources",views:{body:{templateUrl:"views/resourcecentric/resourceCentricBody.html",controller:"resourceCentricController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("resourceCentricController",["$scope","$rootScope","imperaService","$stateParams","BackhaulTable","dialogs","$q",function(a,b,c,d,e,f,g){a.state=d,a.startDryRun=function(){c.dryrun(d.env,d.version).then(function(c){a.dryrunid=c.id,b.$broadcast("refresh")})},a.deploy=function(){c.deploy(d.env,d.version,!0).then(function(a){b.$broadcast("refresh")})},a.tableParams=new e(a,{page:1,count:50},function(b){return c.getResourcesState(d.env).then(function(b){a.env=b,a.versions=b.versions;var c=b.resources;return a.counts={},a.vcount=0,a.maxcount=c.length,angular.forEach(c,function(b){a.counts[b.deployed_version]?a.counts[b.deployed_version]++:(a.counts[b.deployed_version]=1,a.vcount++)}),c})}),a.resources=null,a.details=function(a){c.getResource(d.env,a.id+",v="+a.latest_version).then(function(a){f.create("views/resourceDetail/resourceDetail.html","resourceDetailCtrl",{resource:a,env:d.env},{})})},a.open=function(a){c.getResource(d.env,a.id+",v="+a.latest_version).then(function(a){f.create("views/fileDetail/fileDetail.html","fileDetailCtrl",{resource:a,env:d.env},{})})},a.setFilter=function(b,c){a.tableParams.filter()[b]=c}}]);var resv=angular.module("ImperaApp.restoreView",["ui.router","imperaApi","ngTable","impera.services.backhaul","ImperaApp.inputDialog"]);resv.config(["$stateProvider",function(a){a.state("restores",{url:"/environment/:env/restore",views:{body:{templateUrl:"views/restores/restoreBody.html",controller:"restoreController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("restoreDialogCtrl",["$scope","$modalInstance","data","$stateParams","imperaService",function(a,b,c,d,e){e.getEnvironmentsWithProject().then(function(b){a.envs=b}),e.getSnapshots(d.env).then(function(b){a.snapshots=b}),a.done=function(){e.restoreSnapshot(a.env.id,a.snapshot.id).then(function(a){b.close(a)})},a.cancel=function(){b.dismiss("cancel")}}]),resv.controller("restoreController",["$scope","$rootScope","imperaService","$stateParams","BackhaulTable","dialogs",function(a,b,c,d,e,f){a.state=d,a.tableParams=new e(a,{page:1,count:10,sorting:{started:"desc"}},function(a){return c.getEnrichedRestores(d.env)}),a.deleteRestore=function(a){var e=f.confirm("Confirm delete","Do you really want to delete the restore "+a);e.result.then(function(e){c.deleteRestore(d.env,a).then(function(){b.$broadcast("refresh")})})},a.startRestore=function(a){f.create("views/restores/restoreForm.html","restoreDialogCtrl",{},{}).result.then(function(){b.$broadcast("refresh")})}}]);var resv=angular.module("ImperaApp.snapshotDetailView",["ui.router","imperaApi","ngTable","impera.services.backhaul","ImperaApp.inputDialog"]);resv.config(["$stateProvider",function(a){a.state("snapshot",{url:"/environment/:env/snapshot/:id",views:{body:{templateUrl:"views/snapshotDetail/snapshotDetailBody.html",controller:"snapshotDetailController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("snapshotDetailController",["$scope","$rootScope","imperaService","$stateParams","BackhaulTable","dialogs",function(a,b,c,d,e,f){a.state=d,a.tableParams=new e(a,{page:1,count:10},function(b){return c.getSnapshot(d.env,d.id).then(function(b){return a.sn=b,b.resources})}),a.download=function(a){c.downloadFile(a)}}]);var resv=angular.module("ImperaApp.snapshotView",["ui.router","imperaApi","ngTable","impera.services.backhaul","ImperaApp.inputDialog"]);resv.config(["$stateProvider",function(a){a.state("snapshots",{url:"/environment/:env/snapshot",views:{body:{templateUrl:"views/snapshots/snapshotBody.html",controller:"snapshotController"},side:{templateUrl:"views/env/envSide.html",controller:"sideController"}}})}]),resv.controller("snapshotController",["$scope","$rootScope","imperaService","$stateParams","BackhaulTable","dialogs",function(a,b,c,d,e,f){a.state=d,a.tableParams=new e(a,{page:1,count:10,sorting:{started:"desc"}},function(a){return c.getSnapshots(d.env)}),a.deleteSnapshot=function(a){c.deleteSnapshot(d.env,a).then(function(){b.$broadcast("refresh")})},a.restoreSnapshot=function(a,b){c.restoreSnapshot(a,b)},a.createSnapshot=function(a){f.create("partials/input/inputDialog.html","inputDialogCtrl",{header:"Snapshot name",content:"Name for the snapshot"},{}).result.then(function(a){c.createSnapshot(d.env,a).then(function(){b.$broadcast("refresh")})})}}]),angular.module("ImperaApp").run(["$templateCache",function(a){a.put("partials/directives/breadcrumb.html",'<ol class="col-md-12 breadcrumb"><li ng-repeat="item in breadcrumb" ng-class="{\'active\':item.last}"><a ng-if="!item.id && item.sref" ui-sref={{item.sref}}>{{item.name}}</a> <span ng-if="!item.id && !item.sref">{{item.name}}</span> <span ng-if="item.id && !item.last">{{item.name}}: <a ui-sref={{item.sref}}>{{item.id}}</a></span> <span ng-if="item.id && item.last">{{item.name}}: {{item.id}}</span></li></ol>'),a.put("partials/directives/deployProgress.html",'<div ng-if=name class=row><div class=col-md-1><strong>{{name}}:</strong></div><div class=col-md-{{width}}><progress><bar ng-repeat="bar in data.bars" ng-click=action(bar.name) value=bar.value type={{bar.type}}><span>{{bar.name}} {{bar.label}}</span></bar><div ng-if="data.bars.length==0 && emptyaction" style="width: 100%; text-align: center; cursor:pointer" ng-click=emptyaction()><span class="glyphicon glyphicon-play" aria-hidden=true></span> {{emptyname}}</div></progress></div><div class=col-md-1>total: {{data.total}}</div><div ng-if=remainder class=col-md-{{remainder}}><ng-transclude></ng-transclude></div></div><div ng-if=!name class=row><div class=col-md-8><progress class=compact><bar ng-repeat="bar in data.bars" ng-click=action(bar.name) value=bar.value type={{bar.type}}><span></span></bar></progress></div><div class=col-md-4>{{data.done}} / {{data.total}}</div></div>'),a.put("partials/emptyFilter.html","<label class=radio-inline><input type=checkbox ng-disabled=$filterRow.disabled ng-model=params.filter()[name] ng-true-value=\"'!0'\" ng-false-value=\"''\"> <strong>Has Changes</strong></label>"),a.put("partials/emptysidebar.html",'<div class=row><div class="col-md-2 sidebar"><div class=row style="position:absolute; bottom:55px" ng-controller=configCtrl><div class=col-xs-3><button type=button class="btn btn-default" ng-click=openFeedback(null) data-toggle=tooltip data-placement=top title="Give feedback"><span class="glyphicon glyphicon-thumbs-up"></span> / <span class="glyphicon glyphicon-thumbs-down"></span></button></div><div class=col-xs-9><h5 class=text-right>{{config.backend}}</h5></div></div></div></div>'),a.put("partials/input/inputDialog.html",'<div class="modal-header dialog-header-confirm"><h4 class=modal-title><span class={{icon}}></span> {{header}}</h4></div><div class=modal-body><div class=input-group><input ng-model=result class=form-control placeholder="{{content}}"></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=close() ng-disabled=!result>Create</button></div>'),a.put("partials/projects/projects.html",'<ul class="nav navbar-nav"><li dropdown><a id=simple-dropdown class=pull-right dropdown-toggle><small><span class="glyphicon glyphicon-th-list"></span></small> <span>{{currentProject.name}} {{currentEnv.name}}</span> <span class=caret></span></a><ul class=dropdown-menu aria-labelledby=simple-dropdown><li ng-repeat="project in projects"><a ui-sref=project({project:project.id})>{{project.name}}</a><ul><li ng-repeat="env in project.envs"><a ui-sref=portal({env:env.id})>{{env.name}}</a></li></ul></li><li role=separator class=divider></li><li><a ui-sref=projects()>all projects</a></li></ul></li></ul>'),a.put("partials/refresh/refresh.html",'<div ng-controller=refreshController><ul class="nav navbar-nav"><li><a ng-click=timeSrv.refresh()><span class="glyphicon glyphicon-refresh"></span></a></li><li dropdown><a dropdown-toggle><span class="glyphicon glyphicon-clock"></span> <span ng-show=!refresh>Refresh Off</span> <span ng-show=refresh class=text-warning>refreshed every {{refresh}}</span></a><ul class=dropdown-menu><li ng-repeat="interval in refresh_intervals" ng-class="{&quot;active&quot;:interval==refresh}"><a ng-click=setRefresh(interval)>{{interval}}</a></li></ul></li></ul></div>'),a.put("views/addEnv/addEnv.html",'<div class=row><div class=col-md-12><h2>Create a new Environment</h2></div></div><div class=row><div class=col-md-6><form name=userForm class=form-horizontal ng-submit=addEnv(selectedProject.id,name,repo,selectedTag) novalidate><p class=help-block>An Environment is a dedicated set of virtual resources, associated to a particular project. In an environment, an instance of the project can be deployed and executed in an isolated way, e.g. for development, testing and/or production purposes.</p><div class=form-group ng-class="{ \'has-error\' : userForm.project.$invalid && !userForm.project.$pristine }"><label for=inputProject class="col-sm-2 control-label">Project</label><div class=col-sm-8><select name=project ng-options="item.name for item in projects track by item.id" ng-model=selectedProject class=form-control id=inputProject required></select></div></div><div class=form-group ng-class="{ \'has-error\' : userForm.name.$invalid && !userForm.name.$pristine }"><label for=inputName class="col-sm-2 control-label">Name</label><div class=col-sm-8><input name=name ng-model=name class=form-control id=inputName required></div></div><div class=form-group ng-class="{ \'has-error\' : userForm.repo.$invalid && !userForm.repo.$pristine }"><label for=inputRepo class="col-sm-2 control-label">Repository</label><div class=col-sm-8><input name=repo ng-model=repo class=form-control id=inputRepo required></div></div><div class=form-group ng-class="{ \'has-error\' : userForm.tag.$invalid && !userForm.tag.$pristine }"><label for=inputTag class="col-sm-2 control-label">Branch:</label><div class=col-sm-8><input name=branch ng-model=selectedTag class=form-control id=inputTag required></div></div><a ui-sref=projects><button class="btn btn-primary">Cancel</button></a> <button type=submit class="btn btn-primary" ng-disabled=userForm.$invalid>Create</button></form></div></div>'),a.put("views/addProject/addProject.html",'<h2>Create a new Project</h2><form name=userForm class=form-horizontal ng-submit=addProject(name) novalidate><div class=form-group ng-class="{ \'has-error\' : userForm.name.$invalid && !userForm.name.$pristine }"><label for=inputName class="col-sm-2 control-label">Name</label><div class=col-sm-4><input name=name ng-model=name class=form-control id=inputName required autofocus></div></div><button type=submit class="btn btn-primary" ng-disabled=userForm.$invalid>Create</button></form>'),a.put("views/agents/agentBody.html","<div class=row><im-breadcrumb name=\"'Agents'\"></im-breadcrumb><div class=col-md-12><table class=\"table table-lined\" ng-table=tableParams show-filter=true><tr ng-repeat=\"agent in $data\" ng-class=\"{'warning':agent.expired}\"><td data-title=\"'Hostname'\" data-sortable=\"'hostname'\" filter=\"{ 'hostname':'text'}\">{{agent.hostname}}</td><td data-title=\"'Environment'\" data-sortable=\"'environment'\" filter=\"{ 'environment':'select'}\" filter-data=names() ng-init=\"env=getEnv(agent.environment)\"><a ui-sref=envs({env:agent.environment})>{{env[0].name}}</a></td><td data-title=\"'Name'\" data-sortable=\"'name'\" filter=\"{ 'name':'text'}\">{{agent.name}}</td><td data-title=\"'Last seen'\" data-sortable=\"'last_seen'\" filter=\"{ 'last_seen':'text'}\">{{agent.last_seen|date:'dd/MM/yyyy HH:mm'}}</td><td data-title=\"'Interval'\" data-sortable=\"'interval'\">{{agent.interval}}</td></tr></table></div></div>"),a.put("views/compileReport/compileBody.html",'<div class=row><im-breadcrumb name="\'Compile Report\'"></im-breadcrumb></div><div class=row><div class=col-md-6><select class=form-control ng-model=compile ng-options="compile.started for compile in compiles track by compile.started"></select></div></div><div class=row><div class="col-md-12 detail"><p><strong>Started:</strong> {{compile.started|date:\'dd/MM/yyyy HH:mm\'}}</p><p><strong>Ended:</strong> {{compile.completed|date:\'dd/MM/yyyy HH:mm\'}}</p><p><strong>Time (s):</strong> {{(compile.completed-compile.started)/1000}}</p></div></div><div class=row><div class=col-md-12><table class="table table-lined"><tr><th></th><th>Name</th><th>Command</th><th>Start (s)</th><th>Duration (s)</th><th>Return code</th></tr><tr ng-repeat-start="sub in compile.reports" ng-class="{\'warning\':sub.returncode!=0}"><td><i ng-click="sub.open=!sub.open" class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': sub.open, \'glyphicon-chevron-right\': !sub.open}"></i></td><td>{{sub.name}}</td><td>{{sub.command}}</td><td>+{{(sub.started-compile.started)/1000}}</td><td>{{(sub.completed-sub.started)/1000}}</td><td>{{sub.returncode}}</td></tr><tr ng-repeat-end class="accordian-body collapse" collapse=!sub.open ng-class="{\'warning\':sub.returncode!=0}"><td colspan=6><div class=detail><p><strong>Out stream:</strong><div hljs source=sub.outstream></div></p><p><strong>Error stream:</strong><div hljs source=sub.errstream></div></p></div></td></tr></table></div></div>'),a.put("views/deployReport/reportBody.html",'<div class=row><im-breadcrumb name="\'Deploy Report\'"></im-breadcrumb><ng-include src="\'views/resource/buttonBar.html\'"></ng-include></div><div class=row><div class=col-md-12><h1>Changes Deployed</h1></div><div class=col-md-12 style=min-height:150px ng-hide="tableParams.data.length != 0 || !tableParams.settings().$loading"><span us-spinner="{radius:30, width:8, length: 16}" style="text-align: center; padding-top: 25px"></span></div><div class=col-md-12><table ng-table=tableParams ng-hide="tableParams.data.length == 0 && tableParams.settings().$loading" class="table table-lined" show-filter=true><tr ng-repeat="res in $data"><td data-title="\'type\'" data-sortable="\'id_fields.entity_type\'" filter="{ \'id_fields.entity_type\':\'text\'}">{{res.id_fields.entity_type}}</td><td data-title="\'agent\'" data-sortable="\'id_fields.agent_name\'" filter="{ \'id_fields.agent_name\':\'text\'}">{{res.id_fields.agent_name}}</td><td data-title="\'value\'" data-sortable="\'id_fields.attribute_value\'" filter="{ \'id_fields.attribute_value\':\'text\'}">{{res.id_fields.attribute_value}}</td><td data-title="\'Time\'" data-sortable="\'action.timestamp\'">{{res.action.timestamp|date:\'dd/MM/yyyy HH:mm\'}}</td><td data-title="\'Level\'" data-sortable="\'action.level\'">{{res.action.level}}</td><td data-title="\'Status\'" data-sortable="\'action.level\'">{{res.status}}</td><td data-title="\'Data\'"><span ng-if=res.message style="word-wrap: break-word">{{res.message}}</span><div ng-if=res.action.data ng-repeat="(prop,ft) in res.action.data"><p ng-if="prop!=\'hash\'"><strong>{{prop}}:</strong> {{ft[0]}} <span class="glyphicon glyphicon-arrow-right"></span> {{ft[1]}}</p><button ng-if="prop==\'hash\'" class="btn btn-xs btn-default" ng-click=open(ft,res.id)>Diff</button></div></td></tr></table></div></div>'),a.put("views/diffDetail/diffDetail.html",'<div class="modal-header dialog-header-confirm"><h4 class=modal-title><span class={{icon}}></span> {{header}}</h4></div><div class=modal-body><div><div hljs source="content.join(\'\')"></div></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=close()>Close</button></div>'),a.put("views/editEnv/editEnv.html",'<h2>Edit environment: {{env.name}}</h2><form name=userForm class=form-horizontal ng-submit=editEnv(selectedProject.id,name,repo,selectedTag) novalidate><div class=form-group ng-class="{ \'has-error\' : userForm.project.$invalid && !userForm.project.$pristine }"><label for=inputProject class="col-sm-2 control-label">Project</label><div class=col-sm-4><label name=project class=form-control>{{selectedProject.name}}</label></div></div><div class=form-group ng-class="{ \'has-error\' : userForm.name.$invalid && !userForm.name.$pristine }"><label for=inputName class="col-sm-2 control-label">Name</label><div class=col-sm-4><input name=name ng-model=name class=form-control id=inputName required></div></div><div class=form-group ng-class="{ \'has-error\' : userForm.repo.$invalid && !userForm.repo.$pristine }"><label for=inputRepo class="col-sm-2 control-label">Repository</label><div class=col-sm-4><input name=repo ng-model=repo class=form-control id=inputRepo required></div></div><div class=form-group ng-class="{ \'has-error\' : userForm.tag.$invalid && !userForm.tag.$pristine }"><label for=inputTag class="col-sm-2 control-label">Branch:</label><div class=col-sm-4><input name=Branch ng-model=selectedTag class=form-control id=inputTag required></div></div><div class=row><a ui-sref=envs({env:env.id})><button class="btn btn-primary">Cancel</button></a> <button type=submit class="btn btn-primary" ng-disabled=userForm.$invalid>Submit</button></div></form>'),a.put("views/env/buttonband.html",'<div class="col-md-12 page-button-band" ng-controller=envFunctionController><button type=button class="btn btn-default" ng-click=decommission(state.env)>Decomission</button> <button type=button class="btn btn-default" ng-click=clone(state.env)>Clone</button> <button ui-sref=compileReport({env:state.env}) class="btn btn-default">Compile Reports</button> <button ng-hide=cstate class="btn btn-default" ng-click=updateCompile(state.env)>Update & Recompile</button> <button ng-hide=cstate class="btn btn-default" ng-click=compile(state.env)>Recompile</button> <button ng-hide=!cstate class="btn btn-default">Compiling <i class="fa fa-cog fa-spin"></i></button> <button type=button class="btn btn-default" ui-sref=editEnv({env:state.env})>Edit</button></div>'),a.put("views/env/envBody.html",'<div class=row><im-breadcrumb></im-breadcrumb></div><div class=row><div class="col-md-12 detail"><p><strong>Repo:</strong> {{env.repo_url}}</p><p><strong>Branch:</strong> {{env.repo_branch}}</p></div><ng-include src="\'views/env/buttonband.html\'"></ng-include><div class=col-md-12><table class="table table-lined" ng-table=tableParams><tr ng-repeat="resource in $data track by resource.version" ng-init="extra = {}"><td data-title="\'Date\'" data-sortable="\'date\'">{{resource.date|date:\'dd/MM/yyyy HH:mm\'}}</td><td data-title="\'Version\'" data-sortable="\'version\'"><a ui-sref=resources({env:resource.environment,version:resource.version})>{{resource.version}}</a></td><td data-title="\'Deploy State\'" data-sortable="\'state\'">{{resource.state}}</td><td data-title="\'Deploy Progress\'"><deploy-progress data=resource></deploy-progress></td><td align=right><button class="btn btn-link btn-xs" ng-click=startDryRun(resource) title="Perform dry run"><span class="glyphicon glyphicon-scale" aria-hidden=true></span></button> <button class="btn btn-link btn-xs" ui-sref=report({env:state.env,version:resource.version}) title="Dry run report"><span class="glyphicon glyphicon-list-alt"></span></button> <button class="btn btn-link btn-xs" ng-click=deploy(resource) ng-disabled="resource.released " title="Release version"><span class="glyphicon glyphicon-play" aria-hidden=true></span></button> <button class="btn btn-link btn-xs" ui-sref=deployReport({env:state.env,version:resource.version}) title="Deploy report"><span class="glyphicon glyphicon-tasks"></span></button> <button class="btn btn-link btn-xs" ng-click=deleteVersion(resource) title="Remove version"><span class="glyphicon glyphicon-trash" aria-hidden=true></span></button></td></tr></table></div></div>'),
a.put("views/env/envSide.html",'<div class=row><div class="col-md-2 sidebar"><ul class="nav nav-pills nav-stacked" ng-if=state.env><li ui-sref-active=active><a ui-sref=portal({env:state.env})>Portal</a></li><li ui-sref-active=active ng-class="{\'active\':state.version}"><a ui-sref=envs({env:state.env})>Versions</a></li><li ui-sref-active=active><a ui-sref=resourceCentric({env:state.env})>Resources</a></li><li ui-sref-active=active><a ui-sref=params({env:state.env})>Parameters</a></li><li ui-sref-active=active><a ui-sref=forms({env:state.env})>Forms</a></li><li ui-sref-active=active><a ui-sref=agents({env:state.env})>Agents</a></li><li ui-sref-active=active><a ui-sref=snapshots({env:state.env})>Snapshots</a></li><li ui-sref-active=active><a ui-sref=restores({env:state.env})>Restore</a></li></ul><div class=row style="position:absolute; bottom:55px" ng-controller=configCtrl><div class=col-xs-3><button type=button class="btn btn-default" ng-click=openFeedback(null) data-toggle=tooltip data-placement=top title="Give feedback"><span class="glyphicon glyphicon-thumbs-up"></span> / <span class="glyphicon glyphicon-thumbs-down"></span></button></div><div class=col-xs-9><h5 class=text-right>{{config.backend}}</h5></div></div></div></div>'),a.put("views/feedback/feedback.html",'<div class=modal-header><h3>Please provide your feedback</h3></div><form name=form.userForm ng-submit=submitFeedback(feedback) novalidate><div class=modal-body><div class=form-group><label>Name</label><input name=name class=form-control ng-model=feedback.name required><p ng-show="form.userForm.name.$invalid && !form.userForm.name.$pristine" class=help-block>You name is required.</p></div><div class=form-group><label>User name</label><input name=username class=form-control ng-model=feedback.username ng-minlength=3 required><p ng-show=form.userForm.username.$error.minlength class=help-block>Username is too short.</p><p ng-show=form.userForm.username.$error.maxlength class=help-block>Username is too long.</p></div><div class=form-group><label>Email</label><input type=email name=email class=form-control ng-model=feedback.email required><p ng-show="form.userForm.email.$invalid && !form.userForm.email.$pristine" class=help-block>Enter a valid email.</p></div><div class=form-group><label for=InputMessage>Message</label><div class="input-group col-md-12" ng-model=feedback.message><textarea name=InputMessage id=InputMessage class=form-control rows=5 required></textarea></div></div></div><div class=modal-footer><button class="btn btn-primary" ng-click=cancel()>Cancel</button> <button type=submit class="btn btn-primary" ng-disabled=form.userForm.$invalid>Send</button></div></form>'),a.put("views/feedback/scrap.html",'<div class=col-md-12><form name=form novalidate><h2 ng-if=selectedForm.options.title>{{selectedForm.options.title}}</h2><h2 ng-if=!selectedForm.options.title>{{selectedForm.form_type}}</h2><p>{{selectedForm.options.help}}</p><div class=form-group ng-repeat="(name,type) in selectedForm.fields"><label>{{name}}</label><select class=form-control ng-if="selectedForm.field_options[name][\'widget\']==\'options\'" ng-model=record[name] required><option ng-repeat="item in selectedForm.field_options[name][\'options\'].split(\',\') track by item">{{item}}</option></select><input ng-if="selectedForm.field_options[name][\'widget\']!=\'options\'" type={{getFormType(type)}} name={{name}} ng-model=record[name] class=form-control required><p ng-show="form[name].$invalid && !form[name].$pristine" class=help-block>This field is required.</p></div><button type=submit class="btn btn-primary" ng-disabled=form.$invalid>Send</button></form></div><div class=col-md-12><h1>records</h1><table class="table table-lined"><tr ng-repeat="rec in records"><td>{{rec.changed}}</td><td><a ng-click=selectRecord(rec)>{{rec.id}}</a></td></tr></table></div><div class=col-md-12>{{selectedRecord}}</div>{{allrecords}}'),a.put("views/fileDetail/fileDetail.html",'<div class="modal-header dialog-header-confirm"><h4 class=modal-title><span class={{icon}}></span> {{header}}</h4></div><div class=modal-body><div hljs source=content></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=close()>Close</button></div>'),a.put("views/formsView/formDialog.html",'<div class=modal-header><h3 ng-if=form.options.title>{{form.options.title}}</h3><h3 ng-if=!form.options.title>{{form.form_type}}</h3></div><form name=form.userForm ng-submit=submit() novalidate><div class=modal-body><p>{{form.options.help}}</p><div ng-repeat="type in fieldList track by type.key" ng-switch=type.options.widget><div ng-switch-default class=form-group><label style="text-transform: capitalize">{{type.key | replace:\'_\':\' \'}}</label><input name={{type.key}} ng-model=record.fields[type.key] class=form-control required><p class=help-block>{{type.options.help}}</p></div><div ng-switch-when=options class=form-group><label style="text-transform: capitalize">{{type.key | replace:\'_\':\' \'}}</label><select class=form-control name={{type.key}} ng-model=record.fields[type.key] class=form-control required><option ng-repeat="item in type.options.options track by item">{{item}}</option></select><p class=help-block>{{type.options.help}}</p></div><div ng-switch-when=checkbox class=checkbox><label style="text-transform: capitalize"><input type=checkbox name={{type.key}} ng-model=record.fields[type.key] ng-true-value=true ng-false-value="false"> {{type.key | replace:\'_\':\' \'}}</label><p class=help-block>{{type.options.help}}</p></div><div ng-switch-when=slider class=form-group><label style="text-transform: capitalize">{{type.key | replace:\'_\':\' \'}}</label><input name={{type.key}} ng-model=record.fields[type.key] class=form-control class=form-control slider options=type.options.options required><p class=help-block>{{type.options.help}}</p></div></div></div><div class=modal-footer><button class="btn btn-primary" ng-click=close()>Cancel</button> <button type=submit class="btn btn-primary" ng-disabled=form.userForm.$invalid>Save</button></div></form>'),a.put("views/formsView/formsViewBody.html",'<div class=row><im-breadcrumb></im-breadcrumb></div><div class=row><div class=col-md-12 ng-repeat="form in forms track by form.id"><record-editor env=state.env type=form.type highlight="unknowns.indexOf(form.type)>=0"></div></div>'),a.put("views/formsView/recordEditor.html",'<div class=row><div class="col-md-12 page-header"><a id={{selectedForm.form_type}}></a><h2 ng-if=selectedForm.options.title>{{selectedForm.options.title}}</h2><h2 ng-if=!selectedForm.options.title>{{selectedForm.form_type}}</h2><p class=bg-warning ng-if=highlight>This form must be filled in to compile the model</p><p>{{selectedForm.options.help}}</p></div><div class="col-md-12 page-button-band"><button class="btn btn-default" ng-if=!selectedForm.options.record_count ng-click=addNew(selectedForm)>{{allRecords.length}} Add</button> <button class="btn btn-default" ng-show="allRecords.length<selectedForm.options.record_count" ng-click=addNew(selectedForm)>{{allRecords.length}}/{{selectedForm.options.record_count}} Add</button></div><div class=col-md-12><table ng-table-dynamic="tableParams with cols" class="table table-lined" show-filter="!selectedForm.options.record_count || selectedForm.options.record_count!=1"><tr ng-repeat="record in $data track by record.record_id"><td ng-repeat="col in $columns track by col.field" ng-if=col.field>{{record.fields[col.field]}}</td><td ng-if=true><button class="btn btn-link btn-xs" ng-click=edit(selectedForm,record) title=Edit><span class="glyphicon glyphicon-edit"></button> <button class="btn btn-link btn-xs" ng-click=delete(record) title=Delete><span class="glyphicon glyphicon-trash"></button></td></tr></table></div></div>'),a.put("views/graph/graph.html",'<div class=row><ol class=breadcrumb><li><a ui-sref=projects>Home</a></li><li>Environment:<a ui-sref=envs({env:state.env})>{{env.name}}</a></li><li class=active>Version: {{state.version}}</li></ol><ng-include src="\'views/resource/buttonBar.html\'"></ng-include></div><div class=row style=overflow:hidden><div id=chart style="overflow:hidden;cursor: pointer"></div></div>'),a.put("views/log/logBody.html","<div class=row><im-breadcrumb name=\"'Resource'\" id=state.id></im-breadcrumb><div class=\"col-md-5 detail\"><p><strong>Repo:</strong> {{env.repo_url}}</p><p><strong>Branch:</strong> {{env.repo_branch}}</p><p><strong>ID:</strong> {{env.id}}</p></div><div class=\"col-md-5 detail\"><p><strong>Resource</strong> {{state.id}}</p></div><div class=col-md-12><table class=\"table table-lined\" ng-table=tableParams show-filter=true><tr ng-repeat=\"log in $data\" ng-class=\"{'warning':param.expired}\"><td data-title=\"'Action'\" sortable filter=\"{ 'action':'text'}\">{{log.action}}</td><td data-title=\"'Level'\" sortable filter=\"{ 'level':'text'}\">{{log.level}}</td><td data-title=\"'Time'\" sortable filter=\"{ 'timestamp':'text'}\">{{log.timestamp|date:'dd/MM/yyyy HH:mm'}}</td><td data-title=\"'Msg'\" sortable filter=\"{ 'message':'text'}\">{{log.message}}</td><td data-title=\"'Data'\" sortable filter=\"{ 'data':'text'}\">{{log.data | json}}</td></tr></table></div></div>"),a.put("views/login/login.html",'<div class=modal-header><h3>Login</h3></div><form name=form.userForm ng-submit="login(user, pass)" novalidate><div class=modal-body><div class=form-group><label>User name</label><input name=name class=form-control ng-model=user required></div><div class=form-group><label>Password</label><input type=password name=pass class=form-control ng-model=pass ng-minlength=3 required></div><div class=modal-footer><button class="btn btn-primary" ng-click=cancel()>Cancel</button> <button type=submit class="btn btn-primary" ng-disabled=form.userForm.$invalid>Send</button></div></div></form>'),a.put("views/parameters/parametersBody.html","<div class=row><im-breadcrumb></im-breadcrumb></div><div class=row><div class=\"col-md-5 detail\"><p><strong>Repo:</strong> {{env.repo_url}}</p><p><strong>Branch:</strong> {{env.repo_branch}}</p></div><div class=\"col-md-5 detail\"><p><strong>Expire (s):</strong> {{expire}}</p><p><strong>Server Time:</strong> {{servertime|date:'dd/MM/yyyy HH:mm'}}</p><p><strong>Drift (ms):</strong> {{drift}}</p></div><div class=col-md-12><table class=\"table table-lined\" ng-table=tableParams show-filter=true><tr ng-repeat=\"param in $data\" ng-class=\"{'warning':param.expired}\"><td data-title=\"'Name'\" data-sortable=\"'name'\" filter=\"{ 'name':'text'}\">{{param.name}}</td><td data-title=\"'Resource'\" data-sortable=\"'resource_id'\" filter=\"{ 'resource_id':'text'}\">{{param[\"resource_id\"]}}</td><td data-title=\"'Updated'\" data-sortable=\"'updated'\" filter=\"{ 'updated':'text'}\">{{param.updated|date:'dd/MM/yyyy HH:mm'}}</td><td data-title=\"'Source'\" data-sortable=\"'source'\" filter=\"{ 'source':'select'}\" filter-data=names()>{{param.source}}</td><td data-title=\"'Value'\" data-sortable=\"'value'\" filter=\"{ 'value':'text'}\">{{param.value}}</td></tr></table></div></div>"),a.put("views/portal/portalBody.html",'<div class=row><im-breadcrumb name="\'Portal\'"></im-breadcrumb></div><div class=row><div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 detail"><p><strong>Repo:</strong> {{env.repo_url}}</p><p><strong>Branch:</strong> {{env.repo_branch}}</p></div><div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><ng-include src="\'views/env/buttonband.html\'"></ng-include></div></div><div class=row ng-show="unknowns.length>0"><div class=col-md-12><h2>Required Input</h2><p class=detail>To complete the deployment, user input is required. Below is a list of forms that require input.</p><ul class="list-unstyled detail"><li ng-repeat="unknown in unknowns track by unknown.metadata.form "><a ui-sref="forms({env:state.env,form:unknown.metadata.form,\'#\':unknown.metadata.form})">{{unknown.metadata.form}}</a></li></ul></div></div><div class=row ng-show="report.length>0"><div class=col-md-12><h2>Application Overview</h2></div><div class=col-md-12><table class="table table-nonfluid"><tr ng-repeat="line in report  | orderBy : \'name\' "><td><strong>{{line.name}}</strong></td><td ng-repeat-end ng-switch="line.value.indexof(\'http\')<0"><span ng-switch-default>{{line.value}}</span> <a target=_new href={{line.value}} ng-switch-when=false>{{line.value}}</a></td></tr></table></div></div><div class=row><div class=col-md-12><h2>Deployment Overview</h2></div><div class=col-md-5 ng-show=lastVersion><h3>Lastest Deployed Version</h3><p><strong>Version <a ui-sref=resources({env:state.env,version:lastVersion.version})>{{lastVersion.version}}</a> is currently deployed</strong> <button class="btn btn-link btn-xs" ng-disabled=true title="Perform dry run"><span class="glyphicon glyphicon-scale" aria-hidden=true></span></button> <button class="btn btn-link btn-xs" ui-sref=report({env:state.env,version:lastVersion.version}) title="Dry run report"><span class="glyphicon glyphicon-list-alt"></span></button> <button class="btn btn-link btn-xs" ng-disabled=true title="Release version"><span class="glyphicon glyphicon-play" aria-hidden=true></span></button> <button class="btn btn-link btn-xs" ui-sref=deployReport({env:state.env,version:lastVersion.version}) title="Deploy report"><span class="glyphicon glyphicon-tasks"></span></button></p><deploy-progress data=lastVersion></deploy-progress><p></p><p><strong>Built on:</strong> {{lastVersion.date |date:\'dd/MM/yyyy HH:mm\'}}</p></div><div class=col-md-5 ng-show=newVersion><h3>Newest Version</h3><p><strong>Version <a ui-sref=resources({env:state.env,version:newVersion.version})>{{newVersion.version}}</a> is ready to deploy</strong> <button class="btn btn-link btn-xs" ng-click=startDryRun(newVersion) title="Perform dry run"><span class="glyphicon glyphicon-scale" aria-hidden=true></span></button> <button class="btn btn-link btn-xs" ui-sref=report({env:state.env,version:newVersion.version}) title="Dry run report"><span class="glyphicon glyphicon-list-alt"></span></button> <button class="btn btn-link btn-xs" ng-click=deploy(newVersion) ng-disabled="newVersion.released " title="Release version"><span class="glyphicon glyphicon-play" aria-hidden=true></span></button> <button class="btn btn-link btn-xs" ui-sref=deployReport({env:state.env,version:newVersion.version}) title="Deploy report"><span class="glyphicon glyphicon-tasks"></span></button></p><deploy-progress data=newVersion></deploy-progress><p class=detail><strong>Built on:</strong> {{newVersion.date |date:\'dd/MM/yyyy HH:mm\'}}</p></div></div>'),a.put("views/project/projectBody.html",'<div class=row><div class=col-md-12><div class=page-header><h1>Environments</h1></div></div><div class="col-md-12 page-button-band"><a ui-sref=addEnv({project:state.project})><button type=button class="btn btn-default">Add new environment</button></a></div></div><div class=row><div class=col-md-12><table class="table table-lined" ng-table=tableParams show-filter=false><tr ng-repeat="env in $data"><td title="\'Name\'" data-sortable="\'name\'" filter="{ \'name\':\'text\'}"><a ui-sref=portal({env:env.id})>{{env.name}}</a></td><td title="\'Repo\'" sortable filter="{ \'repo_url\':\'text\'}">{{env.repo_url}}</td><td title="\'Branch\'" sortable filter="{ \'repo_branch\':\'text\'}">{{env.repo_branch}}</td><td><button class="btn btn-default btn-xs" ng-click=deleteEnv(env)><span class="glyphicon glyphicon-trash" aria-hidden=true></span></button> <button class="btn btn-default btn-xs" ui-sref=editEnv({env:env.id})><span class="glyphicon glyphicon-pencil" aria-hidden=true></span></button></td></tr></table></div></div>'),a.put("views/projects/projectBody.html",'<div class=row><div class=col-md-12><div class=page-header><h1>Projects</h1></div></div><div class="col-md-12 page-button-band"><a ui-sref=addProject class=pull-right><button type=button class="btn btn-primary">Add new project</button></a></div></div><div class=row><div class=col-md-12><table class="table table-lined" ng-table=tableParams show-filter=false><tr ng-repeat="project in $data"><td data-title="\'Name\'" data-sortable="\'name\'" filter="{ \'name\':\'text\'}"><a ui-sref=project({project:project.id})>{{project.name}}</a></td><td data-title="\'Id\'" data-sortable="\'id\'" filter="{ \'id\':\'text\'}">{{project.id}}</td><td><button class="btn btn-default btn-xs" ng-click=deleteProject(project)><span class="glyphicon glyphicon-trash" aria-hidden=true></span></button></td></tr></table></div></div>'),a.put("views/report/reportBody.html",'<div class=row><im-breadcrumb name="\'Dryrun Report\'"></im-breadcrumb><ng-include src="\'views/resource/buttonBar.html\'"></ng-include></div><div class=row><div class="col-md-5 page-button-band" ng-if="dryruns.length != 0"><select class=form-control ng-model=dryrun ng-options="dryrun.date for dryrun in dryruns track by dryrun.id"></select></div></div><div class=row ng-if="dryruns.length == 0"><h2>No dry runs for this versions</h2></div><div class=row><div class="col-md-5 detail" ng-if=dryrun.date><p><strong>Started:</strong> {{dryrun.date|date:\'dd/MM/yyyy HH:mm\'}}</p><p><strong>Progress:</strong> {{dryrun.total-dryrun.todo}}/{{dryrun.total}}</p></div><div class=col-md-12 ng-hide=!dryrun.date><div class=col-md-12 style=min-height:150px ng-hide="tableParams.data.length != 0 || !tableParams.settings().$loading"><span us-spinner="{radius:30, width:8, length: 16}" style="text-align: center; padding-top: 25px"></span></div><table ng-table=tableParams ng-hide="tableParams.data.length == 0 && tableParams.settings().$loading" class="table table-lined" show-filter=true><tr ng-repeat="res in $data"><td data-title="\'type\'" data-sortable="\'id_fields.entity_type\'" filter="{ \'id_fields.entity_type\':\'text\'}">{{res.id_fields.entity_type}}</td><td data-title="\'agent\'" data-sortable="\'id_fields.agent_name\'" filter="{ \'id_fields.agent_name\':\'text\'}">{{res.id_fields.agent_name}}</td><td data-title="\'value\'" data-sortable="\'id_fields.attribute_value\'" filter="{ \'id_fields.attribute_value\':\'text\'}">{{res.id_fields.attribute_value}}</td><td data-title="\'Data\'" data-sortable="\'changessize\'" filter="{ \'changessize\':\'partials/emptyFilter.html\'}"><div ng-repeat="(prop,ft) in res.changes"><p ng-if="prop!=\'hash\'"><strong>{{prop}}:</strong> {{ft[0]}} <span class="glyphicon glyphicon-arrow-right"></span> {{ft[1]}}</p><button ng-if="prop==\'hash\'" class="btn btn-xs btn-default" ng-click=open(ft,res.id)>Diff</button></div></td><td><button class="btn btn-link btn-xs" ng-click=details(res) title="View details for this resource"><span class="glyphicon glyphicon-zoom-in"></span></button></td></tr></table></div></div>'),a.put("views/resource/buttonBar.html",'<div class="col-md-12 page-button-band" ng-controller=resourceButtonController><button ui-sref-active=hidden class="btn btn-default" ui-sref=report({env:state.env,version:state.version}) title="Dry run report"><span class="glyphicon glyphicon-list-alt"></span> Dry run report</button> <button class="btn btn-default" ng-click=dryrun() title="Perform dry run"><span class="glyphicon glyphicon-scale" aria-hidden=true></span> Perform dry run</button> <button ui-sref-active=hidden class="btn btn-default" ui-sref=deployReport({env:state.env,version:state.version}) title="Deploy report"><span class="glyphicon glyphicon-tasks"></span> Deploy report</button> <button class="btn btn-default" ng-click=deploy() ng-disabled="resource.released " title="Release version"><span class="glyphicon glyphicon-play" aria-hidden=true></span> Deploy</button> <a ui-sref-active=hidden ui-sref=resources({env:state.env,version:state.version})><button type=button class="btn btn-default"><span class="fa fa-table"></span> Table view</button></a> <a ui-sref-active=hidden ui-sref=graph({env:state.env,version:state.version})><button type=button class="btn btn-default"><span class="fa fa-codepen"></span> Graph view</button></a></div>'),a.put("views/resource/resourceBody.html",'<div class=row><im-breadcrumb></im-breadcrumb></div><deploy-progress data=status name="\'Deploy\'" action=setsort emptyname="\'Deploy\'" emptyaction=deploy></deploy-progress><div class=row><ng-include src="\'views/resource/buttonBar.html\'"></ng-include><div class=col-md-12><table class="table table-lined" ng-table=tableParams show-filter=true><tr ng-repeat="res in $data track by res.id" ng-class="{\'bg-info\':res.id==toHighlight}"><td data-title="\'Type\'" data-sortable="\'id_fields.entity_type\'" filter="{ \'id_fields.entity_type\':\'text\'}"><a ui-sref="logs({env:state.env,id:res.id, version:state.version})">{{res.id_fields.entity_type}}</a></td><td data-title="\'Agent\'" data-sortable="\'id_fields.agent_name\'" filter="{ \'id_fields.agent_name\':\'text\'}">{{res.id_fields.agent_name}}</td><td data-title="\'Value\'" data-sortable="\'id_fields.attribute_value\'" filter="{ \'id_fields.attribute_value\':\'text\'}" class=col-md-2>{{res.id_fields.attribute_value}}</td><td data-title="\'Deps\'" data-sortable="\'deporder\'" class=col-md-2 style="max-width: 90px; word-wrap: break-word"><div ng-repeat="d in res.fields.requires track by $index"><p ng-click=highlight(d)>{{d }}</p></div></td><td data-title="\'State\'" data-sortable="\'status\'" filter="{ \'status\':\'select\'}" filter-data=states() class=col-xs-1>{{res.status}}</td><td><button class="btn btn-link btn-xs" ng-click=details(res)><span class="glyphicon glyphicon-zoom-in"></span></button></td></tr></table></div></div>'),a.put("views/resource/resourceSide.html",'<div class=row><div class="col-md-2 sidebar"><ul class="nav nav-pills nav-stacked"><li ui-sref-active=active><a ui-sref=resources({env:state.env,version:state.version})>Overview</a></li><li ui-sref-active=active><a ui-sref=graph({env:state.env,version:state.version})>Graph</a></li><li ui-sref-active=active><a ui-sref=report({env:state.env,version:state.version})>Report</a></li></ul></div><div class=row style="position:absolute; bottom:50px" ng-controller=configCtrl><div class=col-xs-3><button type=button class="btn btn-default" ng-click=openFeedback(null) data-toggle=tooltip data-placement=top title="Give feedback"><span class="glyphicon glyphicon-thumbs-up"></span> / <span class="glyphicon glyphicon-thumbs-down"></span></button></div><div class=col-xs-9><h5>{{config.backend}}</h5></div></div></div>'),a.put("views/resourceDetail/resourceDetail.html",'<div class="modal-header dialog-header-confirm"><button type=button class=close ng-click=close()>&times;</button><h4 class=modal-title><span class={{icon}}></span> {{header}}</h4></div><div class=modal-body><div><strong>ID:</strong> {{data.id}}</div><div><strong>State:</strong> {{data.state}}</div><div ng-repeat="detail in keys" class=abrev ng-init="hide = (detail.indexOf(\'password\')>=0)"><strong>{{detail}}:</strong> <span ng-hide=hide>{{data.fields[detail]}}</span> <button ng-hide=!hide ng-click="hide=false" class="btn btn-xs btn-link">***</button></div></div><div class=modal-footer><a ui-sref=logs({env:env,id:data.id})><button type=button class="btn btn-default" ng-click=close()>View Log</button></a> <button type=button class="btn btn-default" ng-if=data.fields.hash ng-click=open()>Open File</button> <button type=button class="btn btn-default" ng-click=close()>Close</button></div>'),a.put("views/resourcecentric/resourceCentricBody.html",'<div class=row><im-breadcrumb></im-breadcrumb></div><div class=row><div class=col-md-12><h1>Resources Overview</h1></div></div><div class=row><div class=col-md-12><table class="table table-lined" ng-table=tableParams show-filter=true><tr ng-repeat="res in $data track by res.id"><td style=width:3em data-sortable="\'deployed_version\'"><span ng-if="res.deployed_version==res.latest_version" class="glyphicon glyphicon-ok" title="Up to date"></span></td><td data-title="\'Type\'" data-sortable="\'id_fields.type\'" filter="{ \'id_fields.type\':\'text\'}">{{res.id_fields.type}}</td><td data-title="\'Agent\'" data-sortable="\'id_fields.agent\'" filter="{ \'id_fields.agent\':\'text\'}">{{res.id_fields.agent}}</td><td data-title="\'Value\'" data-sortable="\'id_fields.value\'" filter="{ \'id_fields.value\':\'text\'}" class=col-md-2>{{res.id_fields.value}}</td><td data-title="\'Deployed version\'" data-sortable="\'deployed_version\'" filter="{ \'deployed_version\':\'text\'}"><a ui-sref=resources({env:state.env,version:res.deployed_version})>{{res.deployed_version | nozero}}</a></td><td data-title="\'Latest version\'" data-sortable="\'latest_version\'" filter="{ \'latest_version\':\'text\'}"><a ui-sref=resources({env:state.env,version:res.latest_version})>{{res.latest_version | nozero}}</a></td><td data-title="\'Last Deploy\'" data-sortable="\'last_deploy\'">{{res.last_deploy |date:\'dd/MM/yyyy HH:mm\'}}</td><td><button class="btn btn-link btn-xs" ng-click=details(res) style="color: #333333" title="View details for this resource"><span class="glyphicon glyphicon-zoom-in"></span></button></td></tr></table></div></div>'),a.put("views/restores/restoreBody.html",'<div class=row><div class=col-md-12><div class=page-header><h1>Restores</h1></div></div><div class="col-md-12 page-button-band"><button type=button class="btn btn-default" ng-click=startRestore()>Start Restore</button></div></div><div class=row><div class=col-md-12><table class="table table-lined" ng-table=tableParams show-filter=false><tr ng-repeat="sp in $data"><td data-title="\'Name\'" data-sortable="\'sp.snapshot_id\'" filter="{ \'sp.snapshot_id\':\'text\'}"><a ui-sref=snapshot({env:state.env,id:sp.snapshot})>{{sp.snapshot_id}}</a></td><td data-title="\'Started\'" data-sortable="\'started\'" filter="{ \'started\':\'text\'}">{{sp.started |date:\'dd/MM/yyyy HH:mm\'}}</td><td data-title="\'Duration:s\'"><span ng-hide=!sp.finished>{{ (sp.finished - sp.started)/1000 | number : 1}}</span></td><td data-title="\'Size\'" data-sortable="\'resources_todo\'">{{sp.resources_todo}}</td><td><button class="btn btn-default btn-xs" ng-click=deleteRestore(sp.id) title=Delete><span class="glyphicon glyphicon-trash" aria-hidden=true></span></button></td></tr></table></div></div>'),a.put("views/restores/restoreForm.html",'<div class="modal-header dialog-header-confirm"><h4 class=modal-title>Start Restore</h4></div><form name=userForm ng-submit=done() novalidate><div class=modal-body><div class=form-group><label>Target Environment</label><select ng-model=env name=env ng-options="env.project_full.name +\'.\'+env.name for env in envs track by env.id" required></select><p ng-show="userForm.name.$invalid && !userForm.name.$pristine" class=help-block>Environment Required.</p></div><div class=form-group><label>Snapshot</label><select ng-model=snapshot name=snapshot ng-options="sn.name for sn in snapshots track by sn.id" required></select></div></div><div class=modal-footer><button class="btn btn-primary" ng-click=cancel()>Cancel</button> <button type=submit class="btn btn-primary" ng-disabled=userForm.$invalid>Send</button></div></form>'),a.put("views/snapshotDetail/snapshotDetailBody.html","<div class=row><im-breadcrumb></im-breadcrumb></div><div class=row><div class=\"col-md-6 detail\"><p><strong>Started:</strong> {{sn.started |date:'dd/MM/yyyy HH:mm'}}</p><p><strong>Finished:</strong> {{sn.finished |date:'dd/MM/yyyy HH:mm'}}</p><p><strong>Size:</strong> {{sn.total_size}}</p><p><strong>Name:</strong> {{sn.name}}</p></div></div><div class=row><div class=col-md-12><table class=\"table table-lined\" ng-table=tableParams show-filter=false><tr ng-repeat=\"res in $data\"><td data-title=\"'Name'\" data-sortable=\"'state_id'\" filter=\"{ 'state_id':'text'}\">{{res.state_id }}</td><td data-title=\"'Started'\" data-sortable=\"'started'\" filter=\"{ 'started':'text'}\">{{res.started |date:'dd/MM/yyyy HH:mm'}}</td><td data-title=\"'Duration (s)'\">{{sp.finished - sp.started}}</td><td data-title=\"'Size (kb)'\" data-sortable=\"'size'\" filter=\"{ 'size':'text'}\">{{res.size/1024 | number : 1}}</td><td data-title=\"'Success'\" data-sortable=\"'success'\" filter=\"{ 'success':'text'}\">{{res.success}}</td><td data-title=\"'Error'\" data-sortable=\"'error'\" filter=\"{ 'error':'text'}\">{{res.error}}</td><td data-title=\"'Message'\" data-sortable=\"'msg'\" filter=\"{ 'msg':'text'}\">{{res.msg}}</td><td><button class=\"btn btn-default btn-xs\" ng-click=download(res.content_hash)><span class=\"glyphicon glyphicon-download\" aria-hidden=true></span></button></td></tr></table></div></div>"),a.put("views/snapshots/snapshotBody.html",'<div class=row><div class=col-md-12><div class=page-header><h1>Snapshots</h1></div></div><div class="col-md-12 page-button-band"><button type=button class="btn btn-default" ng-click=createSnapshot()>Create Snapshot</button></div></div><div class=row><div class=col-md-12><table class="table table-lined" ng-table=tableParams show-filter=false><tr ng-repeat="sp in $data"><td data-title="\'Name\'" data-sortable="\'name\'" filter="{ \'name\':\'text\'}"><a ui-sref=snapshot({env:state.env,id:sp.id})><span ng-if=sp.name>{{sp.name}}</span> <span ng-if=!sp.name>No Name</span></a></td><td data-title="\'Started\'" data-sortable="\'started\'" filter="{ \'started\':\'text\'}">{{sp.started |date:\'dd/MM/yyyy HH:mm\'}}</td><td data-title="\'Duration:s\'"><span ng-hide=!sp.finished>{{ (sp.finished - sp.started)/1000 | number : 1}}</span></td><td data-title="\'Size:kb\'" data-sortable="\'total_size\'" filter="{ \'total_size\':\'text\'}">{{sp.total_size/1024 | number : 1}}</td><td data-title="\'Model\'" data-sortable="\'model\'" filter="{ \'model\':\'text\'}"><a ui-sref=resources({env:state.env,version:sp.model})>{{sp.model}}</a></td><td><button class="btn btn-default btn-xs" ng-click=deleteSnapshot(sp.id) title=Delete><span class="glyphicon glyphicon-trash" aria-hidden=true></span></button> <button class="btn btn-default btn-xs" ng-click=restoreSnapshot(state.env,sp.id) title="Restore in place"><span class="glyphicon glyphicon-new-window" aria-hidden=true></span></button></td></tr></table></div></div>')}]);